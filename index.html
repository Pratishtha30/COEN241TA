<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 7.8 (457453)"/><meta name="author" content="朱晓"/><meta name="created" content="2019-01-17 17:59:19 +0000"/><meta name="source" content="desktop.win"/><meta name="source-application" content="yinxiang.win32"/><meta name="source-url" content="https://codelabs.developers.google.com/codelabs/kubeflow-introduction/index.html#2"/><meta name="updated" content="2019-01-24 12:07:09 +0000"/><title>ubuntu install</title></head><body><div><div>Tutorial: <a href="https://codelabs.developers.google.com/codelabs/kubeflow-introduction/index.html#0">https://codelabs.developers.google.com/codelabs/kubeflow-introduction/index.html#0</a></div><div><br/></div><div>install ubuntu:</div><div><a href="https://www.ubuntu.com/">https://www.ubuntu.com/</a></div><div><br/></div><div>download a proper version of google cloud SDK:</div><div><a href="https://cloud.google.com/sdk/downloads#linux">https://cloud.google.com/sdk/downloads#linux</a></div><div><a href="https://cloud.google.com/sdk/docs/quickstart-linux">https://cloud.google.com/sdk/docs/quickstart-linux</a></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>wget https://dl.google.com/dl/cloudsdk/channels/rapid/downloads/google-cloud-sdk-203.0.0-linux-x86_64.tar.gz</div><div>tar -xvf google-cloud-sdk-231.0.0-linux-x86_64.tar.gz</div><div>cd google-cloud-sdk</div><div>./install.sh</div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>gcloud init</div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>gcloud components install kubectl</div></div><div><br/></div><div><br/></div><div>install docker</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>curl -fsSL <a href="https://download.docker.com/linux/ubuntu/gpg">https://download.docker.com/linux/ubuntu/gpg</a> | sudo apt-key add -</div><div>sudo add-apt-repository "deb [arch=amd64] <a href="https://download.docker.com/linux/ubuntu">https://download.docker.com/linux/ubuntu</a> $(lsb_release -cs) stable"</div><div>sudo apt-get update</div><div>apt-cache policy docker-ce</div><div>sudo apt-get install -y docker-ce</div><div><br/></div><div>docker info</div></div><div><br/></div><div>create cluster</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>PROJECT_ID=<font style="color: rgb(255, 64, 255);">coen241-xzhu</font></div><div>gcloud config set project $PROJECT_ID</div><div>gcloud container clusters create kubeflow-codelab --zone us-central1-a --machine-type n1-standard-2</div><div>gcloud container clusters get-credentials kubeflow-codelab --zone us-central1-a</div><div><br/></div><div># make sure kubectl works fine</div><div>kubectl get nodes</div><div><br/></div><div><br/></div><div># I am using kfadmin instead of default-admin as shown in the tutorial</div><div>kubectl create clusterrolebinding <font color="#942192"><b>kfadmin</b></font> \</div><div>     --clusterrole=cluster-admin --user=$(gcloud config get-value account)</div><div><br/></div></div><div><br/></div><div>install ks tools</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>KS_VER=ks_0.11.0_linux_amd64</div><div>wget --no-check-certificate <a href="https://github.com/ksonnet/ksonnet/releases/download/v0.11.0/$KS_VER.tar.gz">https://github.com/ksonnet/ksonnet/releases/download/v0.11.0/$KS_VER.tar.gz</a></div><div>tar -xvf $KS_VER.tar.gz</div><div>PATH=$PATH:$(pwd)/$KS_VER</div></div><div><br/></div><div><br/></div><div>download repo</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>wget <a href="https://github.com/googlecodelabs/kubeflow-introduction/archive/master.zip">https://github.com/googlecodelabs/kubeflow-introduction/archive/master.zip</a></div></div><div><br/></div><div>init ksonnet</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div><i>ks init ksonnet-kubeflow</i></div><div><i>cd ksonnet-kubeflow</i></div></div><div><br/></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>ks env add cloud</div><div>ks generate core kubeflow-core --name=kubeflow-core --cloud=gke</div><div>ks apply cloud -c kubeflow-core</div><div>kubectl get all</div></div><div><br/></div><div><br/></div><div>Part3</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div><br/></div><div>BUCKET_NAME=funtest-xzhu4</div><div>gsutil mb gs://$BUCKET_NAME/</div><div><br/></div><div><br/></div><div>//move back to the kubeflow-introduction project directory</div><div>cd ..</div><div>//create service account</div><div>gcloud iam service-accounts create kubeflow-codelab --display-name kubeflow-codelab</div><div><br/></div><div><br/></div><div>PROJECT_ID=coen241-ubuntu</div><div>IAM_EMAIL=kubeflow-codelab@$PROJECT_ID.iam.gserviceaccount.com</div><div>gsutil acl ch -u $IAM_EMAIL:O gs://$BUCKET_NAME</div><div><br/></div><div># important</div><div>gcloud iam service-accounts keys create ./tensorflow-model/key.json --iam-account=$IAM_EMAIL</div><div><br/></div><div><br/></div><div><b>Build Container</b></div><div><br/></div><div>VERSION_TAG=$(date +%s)</div><div>TRAIN_PATH=us.gcr.io/$PROJECT_ID/kubeflow-train:$VERSION_TAG</div><div>docker build -t $TRAIN_PATH ./tensorflow-model --build-arg version=$VERSION_TAG --build-arg bucket=$BUCKET_NAME</div><div><br/></div><div><br/></div><div>docker run -it $TRAIN_PATH</div></div><div style="box-sizing: border-box; margin: 0px; padding: 0px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><div style="box-sizing: border-box; margin: 0px; padding: 0px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div><br/></div><div>//allow docker to access our GCR registry</div><div>gcloud auth configure-docker</div><div><br/></div><div>//push container to GCR</div><div>docker push $TRAIN_PATH</div></div><div><br/></div><div><br/></div><h2><span style="font-weight: bold;">Training on the Cluster</span></h2><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>//move back into ksonnet directory</div><div>cd ksonnet-kubeflow</div><div><br/></div><div>//generate component from prototype</div><div>ks generate tf-job train</div><div><br/></div><div>//set the parameters for this job</div><div>ks param set train image $TRAIN_PATH</div><div>ks param set train name "train-"$VERSION_TAG</div><div><br/></div><div>Apply the container to the cluster:</div><div>ks apply cloud -c train</div><div><br/></div><div>kubectl describe tfjob</div></div><div><br/></div><div><br/></div><div>Serving</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>//create a ksonnet component from the prototype</div><div>ks generate tf-serving serve --name=mnist-serve</div><div>//set the parameters and apply to the cluster</div><div>ks param set serve modelPath gs://$BUCKET_NAME/</div><div>ks apply cloud -c serve</div></div><div><br/></div><div>Deploying UI</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>//move back to the kubeflow-introduction project directory</div><div>cd ..</div><div><br/></div><div>UI_PATH=us.gcr.io/$PROJECT_ID/kubeflow-web-ui</div><div><br/></div><div>docker build -t $UI_PATH ./web-ui</div><div>gcloud auth configure-docker</div><div>docker push $UI_PATH</div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>//move back into ksonnet project directory</div><div>cd ksonnet-kubeflow</div><div><br/></div><div>ks generate deployed-service web-ui --name=web-ui --image=$UI_PATH \</div><div>      --type=LoadBalancer --containerPort=5000 --servicePort=80 </div><div><br/></div><div>//apply component to our cluster</div><div>ks apply cloud -c web-ui</div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>kubectl get service web-ui</div></div><div><br/></div><div>END</div></div><div><br/></div></body></html>
